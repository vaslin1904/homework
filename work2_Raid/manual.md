# **Создание программного Raid**
______________________________________
## Программное обеспечение, используемое для выполнение работы
Домашняя система - ОС Windows 11
Vagrant     - 2.2.19
Packer      - 1.8.0
client GIT  - 2.36.0
Virtual Box - 6.1
Виртуальная система - centos 7
Командная строка Windows
_________________________________________
## Порядок действий для создания Raid 5
1. Проверим наличие дисков, на которых будет разворачиватться Рейд 5, нам нужно минимум 4 диска <br>
__** lsblk -вывод блочных устройств **__
2.Необходимо занулить суперблоки для стирания служебной информации о других Рейдах, если диск ранее использовался. <br>
__**mdadm --zero-superblock --force /dev/sd{b,c,d,e,f}**__
3. Создаем 5-й рейд: **sudo mdadm --create --verbose /dev/md0 -l 5 -n 4 /dev/sd{b,c,d,e}**
4. Проверим создание рейда, просмотрим о нем информацию :**mdadm -D /dev/md0** или **cat /proc/mdstat** <br>
5. Для сборки рейда при каждом запуске системы содаем конфигурационный файл. Файл создается пол суперпользователем <br>
                    **echo "DEVICE partitions" > /etc/mdadm/mdadm.conf**
6. В конфигурационный файл добавляем информацию о созданном рейде:
                     **mdadm --detail --scan --verbose | awk '/ARRAY/{print}' >> /etc/mdadm/mdadm.conf**
7. Выведем из строя один диск: **mdadm /dev/md0 --fail /dev/sde**
и удалим его из рейда **mdadm /dev/md0 --remove /dev/sde**
8. Добавим в рейд новый диск **mdadm /dev/md0 --add /dev/sdf**
9. Создадим на собранном рейде 5 разделов.
**parted -s /dev/md0 mklabel gpt
parted /dev/md0 mkpart primary ext4 0% 20%
parted /dev/md0 mkpart primary ext4 20% 40%
parted /dev/md0 mkpart primary ext4 40% 60%
parted /dev/md0 mkpart primary ext4 60% 80%
parted /dev/md0 mkpart primary ext4 80% 100%**
10.На каждом разделе создаем файловую систему ext4: **for i in $(seq 1 5); do sudo mkfs.ext4 /dev/md0p$i; done**
11.Монтируем разделы : 
**mkdir -p /raid/part{1,2,3,4,5}
for i in $(seq 1 5); do mount /dev/md0p$i /raid/part$i; done**
12. Размонтируем разделы **for i in $(seq 1 5); do umount /dev/md0p$i /raid/part$i; done**
13. Останавливаем рейд **mdadm -S /dev/md0** и очищаем суперблоки **mdadm --zero-superblock /dev/sd{b,c,d,e}**
__________________________________________________________________________________________________________________
## ИТОГИ
___________________________________________________________________________________________________________________
Пример сборки зеркального рейда прописан в скрипте (папка rezult). Для того, чтобы команда mdadm автоматически получала<br>
согласие на установку рейда после команды создания рейла была добавлена строка
**<<EOF yes EOF**
В Вагрант файл были добавлены диски и добавлен скрипт на создание зеркально рейда при сборке системы.
      
      
