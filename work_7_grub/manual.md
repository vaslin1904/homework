# **Работа с загрузчиком GRUB**
___________________________________________
## **Зайти в систему через загрузчик**
___________________________________________
1. Для того, чтобы попасть в загрузчик системы при ее загрузке, необходимо нажать "e"(edit) при появлении окна выбора ядра системы.
2. **Способ 1.** В конце строки начинающейся с *linux16* добавляем <sup> init=/bin/sh </sup> и нажимаем **сtrl-x** для
загрузки системы:
![Редактирование Grub во время загрузки](images/way1.png)

- Рутовая файловая система при этом монтируется в режиме *Read-Only*. Поэтому её необходимо <br> перемонтировать режим *Read-Write*:
**mount -o remount,rw /**

![Система в режиме Read Only](images/way1_ro.png)

- Проверим, что перешли в режим *rw*. Для этого создадим файл "file1" в папке <sup>/home</sup> и поместим в него текст "privet": 

![Система в режиме Read Write](images/way1_mount_rw.png)
 
3. **Способ 2.** В конце строки начинающейся с *linux16* добавляем <sup> rd.break </sup> и нажимаем **сtrl-x** для
загрузки системы:
![Редактирование Grub во время загрузки](images/way2_grub.png)

- Рутовая файловая система при этом монтируется в режиме *Read-Only*.

![Система в режиме Read Only](images/way2_rw.png)
- Теперь нужно попасть в систему в режиме *rw* и назначить новый пароль root:
- [x]	mount -o remount,rw /sysroot
- [x] chroot /sysroot
- [x] passwd root
-	Проверим, что теперь система в режиме *RW* : **touch /.autorelabel**
![Система в режиме Read Write](images/way2_rez.png)

4. **Способ 3.** В строку начинающейся с *linux16* добавляем <sup> rw init=/sysroot/bin/bash </sup> и нажимаем **сtrl-x** для
загрузки системы:
![Редактирование Grub во время загрузки](images/way3_grub.png)
- Система загружается сразу в режиме *RW*:
![Система в режиме Read Write](images/way3_check.png)
_____________________________________________________________________
## **Установить систему с LVM, после чего переименовать VG**
_____________________________________________________________________
1. Убедимся в наличии *lvm*: **vgs**
![Проверка LVM](images/lvm_check.png)
2. Переименуем *Volume* группу: **vgrename VolGroup00 OtusRoot**

![Переименование Volume Group](images/lvm_renameVG.png)
3. Правим файл монтирования: **vi /etc/fstab**

![Правка файла fstab](images/lvm_edit_fstab.png)
4. Правим файл с начальными настройками загрузчика: **vi /etc/default/grub**

![Правка default Grub](images/lvm_editGrub.png)
5. Правим конфигурационный файл загрузчика: **vi /boot/grub2/grub.cfg**

![Правка файла grub.cfg](images/lvm_edit_Grub2.png)
6. Пересобираем образ файловой системы, загружаемый в оперативную память вместе с ядром - **initramfs**:<br>
**mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)**

![Пересборка initramfs](images/lvm_edit_Grub2.png)
7. Перезагружаем систему и убеждаемся, что LVM имеет измененное имя Volume Group:

![Проверка загрузки системы с новым имененм VG](images/lvm_checkWork.png) 
______________________________________________
## **Добавить модуль в initrd**
______________________________________________
1. Создадим папку с именем *01test*:**mkdir /usr/lib/dracut/modules.d/01test**

![Создание папки](images/module_dir.png)

2. В созданную папку помещаем скрипт *module-setup.sh*:

![Создание скрипта](images/module_sh.png)

3.  В созданную папку помещаем скрипт *test.sh*:

![Создание скрипта](images/module_test_sh.png)

4.  Пересобираем образ файловой системы, загружаемый в оперативную память вместе с ядром - **initramfs**:<br>
**mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)**<br>
или<br>
**dracut -f -v**

![Пересборка initramfs](images/module_initramfs.png)

5. Убедимся, что модуль test загружен в образ: **lsinitrd -m /boot/initramfs-$(uname -r).img | grep test**

![Проверка загрузки модуля](images/module_check.png)

6. Отредактируем файл grub.cfg. Убираем параметры rghb и quiet.
**В результате загрузки системы подзагружается новый модуль**

![Результат загрузки модуля](images/module_rez.png)

____________________________________________
## **Вывод**
_____________________________________________
Файл Vagrant подзагружает box из облака, в котором уже есть LVM и переименована Volume Group, <br>
а также при запуске системы в графическом режиме Virtual Box можно увидеть встроенный модуль ядра при загрузке системы.


